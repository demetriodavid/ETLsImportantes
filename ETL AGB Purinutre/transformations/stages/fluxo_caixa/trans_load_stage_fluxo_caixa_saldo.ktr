<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>Trans Carga Stage - Fluxo de caixa</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection />
        <schema />
        <table />
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2022/06/15 00:32:59.631</created_date>
    <modified_user>-</modified_user>
    <modified_date>2022/06/15 00:32:59.631</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>[DB] - MySQL - Fluig ECM</name>
    <server>${ORIGEM_FLUIG_HOST}</server>
    <type>MARIADB</type>
    <access>Native</access>
    <database>${ORIGEM_FLUIG_BANCO}</database>
    <port>${ORIGEM_FLUIG_PORTA}</port>
    <username>${ORIGEM_FLUIG_USER_NAME}</username>
    <password>${ORIGEM_FLUIG_PASSWORD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${ORIGEM_FLUIG_PORTA}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>[DB] - Oracle - AgriBusiness ERP</name>
    <server>${ORIGEM_ORACLE_HOST}</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>${ORIGEM_ORACLE_BANCO}</database>
    <port>${ORIGEM_ORACLE_PORTA}</port>
    <username>${ORIGEM_ORACLE_USER_NAME}</username>
    <password>${ORIGEM_ORACLE_PASSWORD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${ORIGEM_ORACLE_PORTA}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>[DB] - PostgreSQL - Vistra Templ BI</name>
    <server>${ORIGEM_VISTRA_HOST}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${ORIGEM_VISTRA_BANCO}</database>
    <port>${ORIGEM_VISTRA_PORTA}</port>
    <username>${ORIGEM_VISTRA_USER_NAME}</username>
    <password>${ORIGEM_VISTRA_PASSWORD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${ORIGEM_VISTRA_PORTA}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>[DW] - PostgreSQL - Vistra BI</name>
    <server>${DESTINO_HOST}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${DESTINO_BANCO}</database>
    <port>${DESTINO_PORTA}</port>
    <username>${DESTINO_USER_NAME_BD}</username>
    <password>${DESTINO_PASSWORD_BD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${DESTINO_PORTA}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Wait Truncate</from>
      <to>[DW] - Insert - stg_fluxo_caixa_realizado</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>[DB] - Extracao ERP - Extração Saldo Fluxo</from>
      <to>Wait Truncate</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Wait Truncate</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>[DW] - SQL - Truncate Table</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>303</xloc>
      <yloc>174</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>[DB] - Extracao ERP - Extração Saldo Fluxo</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>[DB] - Oracle - AgriBusiness ERP</connection>
    <sql>WITH LANCAMENTOS_FIN_FLUXO_CAIXA AS(
SELECT C.CODI_CON                                                   AS CONTA,
       CAST('-1' AS INTEGER)                                        AS CTRL_LAN,
       'D'                                                          AS ENTRADA_SAIDA,
       C.DESC_CON                                                   AS DESC_CON,
       COALESCE( C.DABE_CON , TO_DATE( '2000/01/01', 'yyyy/mm/dd')) AS DATA_LAN,
	   COALESCE(C.CODI_EMP, 1)                                     AS EMPRESA,
	   CAST(COALESCE(C.SABE_CON, 0) AS NUMERIC(21,9))               AS VALOR
  FROM CONTA C
 WHERE COALESCE(C.SABE_CON, 0) &lt;&gt; 0
 
 UNION ALL
 
SELECT LAN.CODI_CON                           AS CONTA,
       LAN.CTRL_LAN                           AS CTRL_LAN,
       HIST.TIPO_HIS                          AS ENTRADA_SAIDA,
       CO.DESC_CON                            AS DESC_CON,
       LAN.DATA_LAN                           AS DATA_LAN,
       COALESCE(CO.CODI_EMP, 1)              AS EMPRESA,
       CAST(COALESCE(CASE HIST.TIPO_HIS WHEN 'C' THEN LAN.VLOR_LAN * -1 
                                        ELSE LAN.VLOR_LAN
                     END,0) AS NUMERIC(21,9)) AS VALOR
  FROM LANCAMEN             LAN
       INNER JOIN CONTA     CO   ON (CO.CODI_CON = LAN.CODI_CON)
       INNER JOIN HISTORICO HIST ON (HIST.HIST_HIS = LAN.HIST_HIS)
       --LEFT JOIN CPGBAIXA B      ON B.CTRL_LAN = LAN.CTRL_LAN
       --LEFT JOIN PAGAR    P      ON B.CTRL_PAG = P.CTRL_PAG
       --LEFT JOIN CABPAGAR C      ON C.CTRL_CPG  = P.CTRL_CPG
 WHERE HIST.TIPO_HIS &lt;&gt; 'N'
   --AND DATA_LAN = TO_DATE('29/08/2011', 'DD/MM/YYYY')
   --AND LAN.CODI_CON = '120'
   /*AND LAN.CODI_CON IN ('3',--ADIANTAMENTO A FORNECEDOR
                      '10000007', --A RECEBER - CONTAS ANTIGAS
                      '103', --ADIANTAMENTO DE CLIENTE
                      '12', -- ADIANTAMENTO PARA VIAGEM
                      '105', -- CARTAO/CONVENIOS
                      '104', -- CHEQUE A VISTA
                      '108', -- CHEQUE GARANTIA
                      '107', -- CHEQUE PRE
                      '101', --DUPLICATA A RECEBER
                      '110', --DUPLICATA RECEBER-IMPLANTACAO
                      '301', -- DUPLICATA SERVICOS
                      '10000317', --EMPRESTIMOS A DIRETORES
                      '10000330', --EMPRESTIMO DE TERCEIROS
                      '10000321', --DUPLICATA A RECEBER - SPE
                      '10000012', --CONTAS PERDIDAS
                      '10000315', -- CHEQUE DEVOLVIDO - A RECEBER
                      '10000307', --BONUS 
                      '10000008' , --CARTAO BNDES
                      '10000011', --CARTOES CORPORATIVOS
                      '10000324', -- CONSORCIOS
                      '11', --CONTAS A PAGAR
                      '10000310', -- CONTAS A PAGAR INDUSTRIA
                      '10000325', -- CONTRATO DE TERRENO
                      '40', -- DAM - ISSQN
                      '41' , -- DAM - ISSQN RETIDO
                      '50', --DARE - ICMS
                      '51', --DARE - ICMS DIF ALIQUOTA
                      '10000319', --DARE - OUTRAS TAXAS
                      '10000320', --DARE - SIMPLES NACIONAL
                      '31' , -- DARF - COFINS
                      '32', --DARF - CSL
                      '33', -- DARF - IRPJ
                      '35', --DARF - IRRF PF FUNC/EMPREG/AUT
                      '36' , --DARF - IRRF PF TERCEIROS
                      '37' , -- DARF - IRRF PJ TERCEIROS
                      '30' , --DARF - PIS
                      '34' , -- DARF - PIS/COFINS/CSL RETIDOS
                      '18' , -- DISTRIB. ANTECIPADA LUCROS
                      '19',  --DISTRIBUICAO LUCROS
                      '10', --DUPLICATA PAGAR-IMPLANTACAO
                      '4', -- EMPRESTIMOS BANCARIOS
                      '8', -- ENCARGOS EMPRESTIMOS BANCARIOS
                      '9', --ENCARGOS FINANC BANCARIOS
                      '10000331', --ESTORNO
                      '10000009', -- FINAME
                      '5', --FINANCIAMENTOS BANCARIOS
                      '70', --  FINANCIAMENTOS VENDOR
                      '1', -- FORNECEDORES
                      '10000311', -- FORNECEDORES INDUSTRIA
                      '316', --  FP - ADIANTAMENTO FERIAS
                      '314', -- PENSAO ALIMENTICIA
                      '13',  -- FP ADIANTAMENTO PRO-LABORE
                      '20',  -- FP ADIANTAMENTO SALARIO
                      '29',  --  FP CONTRIBUICAO SINDICAL
                      '28',  -- FP EMPRESTIMO A DIRIGENTE
                      '27',  -- FP EMPRESTIMO A FUNCIONARIO
                      '22',  -- FP FERIAS
                      '21',  -- FP SALARIOS
                      '23',  -- FP 13o SALARIO
                      '61', -- FP GFIP - FGTS
                      '10000323', -- FP GFIP - FGTS SINDICATO
                      '60', --FP GPS - INSS
                      '10000322', --FP GPS - INSS SINDICATO
                      '25', -- FP PRO-LABORE
                      '24', -- FP RESCISAO
                      '26', -- FP RPA/AUTONOMOS
                      '312', -- GASTOS PROVISIONADOS
                      '10000305', -- GRRF-RECISORIO
                      '10000328', -- INVESTIMENTOS - CDCA
                      '304',   --JUROS S/EMPRESTIMOS
                      '300',  -- JUROS S/FINANCIAMENTOS
                      '10000010', --  LEASING
                      '10000327', -- NOTA CREDITO - MARKETING
                      '7', -- NOTA CREDITO EQUALIZACAO CPG
                      '2', --NOTA CREDITO FINANCEIRA CPG
                      '102', -- NOTA CREDITO FINANCEIRA CRC
                      '10000326', --  NOTA DE CREDITO - REBATE
                      '303',  -- PARCELAMENTO ICMS
                      '302',  --  PARCELAMENTO PIS/COFINS
                      '10000318', --  PREMIACAO FORNECEDORES
                      '10000308', -- PREMIACOES
                      '80',  --  PROVISAO ADTO FORNECEDOR
                      '10000306', --RDAR - A VISTA
                      '10000309' --  RDAR - CARTÃO
) */


)
, CCU AS(
SELECT CL.CTRL_CLC,
       CAST(CC.CODI_PLC AS VARCHAR2(15))||'#'||CAST(CC.CODI_CCU AS VARCHAR2(15)) CODI_CCU
  FROM CABLANCTB                   CL
       LEFT JOIN LANCONTAB         LC   ON  LC.SEQU_CLC    = CL.SEQU_CLC
       INNER JOIN CCUSTOLAN        CC   ON  CC.SEQU_LCT    = LC.SEQU_LCT
 WHERE CL.ORIG_CLC = 'FC'        
 GROUP BY CL.CTRL_CLC, CC.CODI_CCU, CC.CODI_PLC
)
       
SELECT CONTA                              AS NK_CONTA_FLUXO_CAIXA,
       DATA_LAN                           AS NK_TEMPO_DIA_VENC ,
       CAST (SUM(VALOR) AS NUMERIC(21,9)) AS VALOR,
	   EMPRESA                            AS NK_EMPRESA,
	   CASE WHEN ENTRADA_SAIDA = 'C' THEN 'S' 
	        ELSE 'E'
	   END                                AS NK_ENTRADA_SAIDA,
       '-1' AS NK_CENTRO_CUSTO
	   
       --COALESCE(CC.CODI_CCU,'-1')         AS NK_CENTRO_CUSTO
  FROM LANCAMENTOS_FIN_FLUXO_CAIXA LFFC
      -- LEFT JOIN CCU CC ON CC.CTRL_CLC = LFFC.CTRL_LAN
--where lffc.data_lan &lt;= to_date('31/05/2022','dd/mm/yyyy')
--   and lffc.conta = '100'
--   and lffc.empresa = '1'
 GROUP BY ENTRADA_SAIDA, EMPRESA, DATA_LAN, CONTA  </sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>106</xloc>
      <yloc>174</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>[DW] - Insert - stg_fluxo_caixa_realizado</name>
    <type>TableOutput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>[DW] - PostgreSQL - Vistra BI</connection>
    <schema>stage</schema>
    <table>stg_fluxo_caixa_realizado</table>
    <commit>100</commit>
    <truncate>N</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field />
    <partitioning_daily>N</partitioning_daily>
    <partitioning_monthly>Y</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>Y</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>NK_CONTA_FLUXO_CAIXA</column_name>
        <stream_name>NK_CONTA_FLUXO_CAIXA</stream_name>
      </field>
      <field>
        <column_name>NK_TEMPO_DIA_VENC</column_name>
        <stream_name>NK_TEMPO_DIA_VENC</stream_name>
      </field>
      <field>
        <column_name>VALOR</column_name>
        <stream_name>VALOR</stream_name>
      </field>
      <field>
        <column_name>NK_EMPRESA</column_name>
        <stream_name>NK_EMPRESA</stream_name>
      </field>
      <field>
        <column_name>NK_ENTRADA_SAIDA</column_name>
        <stream_name>NK_ENTRADA_SAIDA</stream_name>
      </field>
      <field>
        <column_name>NK_CENTRO_CUSTO</column_name>
        <stream_name>NK_CENTRO_CUSTO</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>488</xloc>
      <yloc>174</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>[DW] - SQL - Truncate Table</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>[DW] - PostgreSQL - Vistra BI</connection>
    <execute_each_row>N</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>truncate table stage.stg_fluxo_caixa_realizado;</sql>
    <set_params>N</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>276</xloc>
      <yloc>38</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
