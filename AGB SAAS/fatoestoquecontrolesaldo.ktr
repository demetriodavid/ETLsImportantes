<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>fatoestoquecontrolesaldo</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
    <log>
      <trans-log-table>
        <connection>SQL Server</connection>
        <schema />
        <table>dimArquivoTransformacao</table>
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>5000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2015/09/02 16:35:08.215</created_date>
    <modified_user>-</modified_user>
    <modified_date>2015/09/02 16:35:08.215</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Oracle</name>
    <server />
    <type>ORACLE</type>
    <access>Native</access>
    <database>${ORIGEM_ERP_BANCO}</database>
    <port>-1</port>
    <username>${ORIGEM_USER_NAME_BD}</username>
    <password>${ORIGEM_PASSWORD_BD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>-1</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SQL_CONNECT</code>
        <attribute>alter session set "_optimizer_join_elimination_enabled"=false;alter SESSION set NLS_DATE_FORMAT = 'DD/MM/YYYY' </attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>SQL Server</name>
    <server>${DESTINO_POSTGRES_HOST}</server>
    <type>POSTGRESQL</type>
    <access>Native</access>
    <database>${DESTINO_POSTGRES_BANCO}</database>
    <port>${DESTINO_POSTGRES_PORTA}</port>
    <username>${DESTINO_USER_NAME_BD}</username>
    <password>${DESTINO_PASSWORD_BD}</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>EXTRA_OPTION_POSTGRESQL.sslmode</code>
        <attribute>require</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>${DESTINO_POSTGRES_PORTA}</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Custo</from>
      <to>Select values custo</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Data Partida</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Data Partida</from>
      <to>Select values 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Data Partida</from>
      <to>Select values 5</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Elimina colunas</from>
      <to>Group by</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Emp x Prod</from>
      <to>Sort rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Estoque</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Estoque</from>
      <to>Select values Estoque</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>Elimina colunas</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Group by</from>
      <to>Custo</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Join</from>
      <to>Select values from ERP</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Rows (diff)</from>
      <to>Fato Mov Estoque Ctrl Saldo</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Rows (diff) 2</from>
      <to>Fato Custo Produto</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Rows (diff) 3</from>
      <to>Synchronize after merge</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Merge Rows (diff) 4</from>
      <to>Sync saldo inicial</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>ORIGEM</from>
      <to>Merge Rows (diff) 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select from DW</from>
      <to>Sort rows from DW</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Emp x Prod</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 2</from>
      <to>Wait Flag</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 3</from>
      <to>Estoque</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 5</from>
      <to>Select from DW</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 5</from>
      <to>datas estoque afetadas</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values Estoque</from>
      <to>Merge Join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values custo</from>
      <to>Merge Join</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values from ERP</from>
      <to>Merge Rows (diff) 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows</from>
      <to>Select values 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort rows from DW</from>
      <to>Merge Rows (diff) 4</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>TIPO 0</from>
      <to>Merge Rows (diff) 3</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Wait Flag</from>
      <to>fato</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Wait Flag</from>
      <to>fato 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Wait Flag</from>
      <to>stage custo</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Wait Flag</from>
      <to>stage estoque</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>datas estoque afetadas</from>
      <to>wait insert/update</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>fato</from>
      <to>Merge Rows (diff)</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>fato 2</from>
      <to>Merge Rows (diff) 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>stage custo</from>
      <to>Merge Rows (diff) 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>stage estoque</from>
      <to>Merge Rows (diff)</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>wait insert/update</from>
      <to>Flag Concluido</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Custo</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>with emp_prod as 
(
	SELECT  
		cast(? as date) data_estoque
		,cast(? as int) empresa
		, ? produto 
	from dual
)

select 
	cast(ep.empresa as int) empresa
	, ep.produto
	, ep.data_estoque "DATA"
  	, (SELECT CUST_MED  FROM  table( CUSTO_MEDIO( ep.empresa , ep.produto, ep.data_estoque) )) AS CUSTOMEDIO
	, (SELECT CUST_REP FROM TABLE(CUSTO_REPOSICAO(ep.empresa,ep.produto, ep.data_estoque)) ) CUSTOREPOSICAO
--	,0 CUSTOREPOSICAO
	, (SELECT CUST_COM FROM TABLE(CUSTO_COMPRA(ep.empresa,ep.produto, ep.data_estoque, ep.data_estoque)) ) CUSTOCOMPRA
from emp_prod ep </sql>
    <limit>0</limit>
    <lookup>Group by</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1527</xloc>
      <yloc>702</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Data Partida</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>
/*
	para extrair uma data específica, substituir todas as ocorrências de [current_timestamp] por [select cast(current_date + interval '1 day' as timestamp)]

*/
select cast(current_timestamp - interval '33 hour' as date) data_estoque
	, COALESCE(
		(select  max("DATA") from fatoestoquesaldoinicial where "DATA" &lt; cast(current_timestamp - interval '33 hour' as date) AND concluido = 'S')
		, current_date - interval '1 year'
	) data_partida_mov
	, (select max(insert_date) ultima_extracao  from fatoestoquesaldoinicial where concluido = 'S' and "DATA" = cast(current_timestamp - interval '33 hour' as date) ) ultima_extracao
	, current_timestamp - interval '5 hour' insert_date_atual
union 
select cast(current_timestamp - interval '9 hour' as date) data_estoque, cast(current_timestamp - interval '33 hour' as date) data_partida_mov, 
(select max(insert_date) ultima_extracao  from fatoestoquesaldoinicial WHERE concluido = 'S'and cast(current_timestamp - interval '9 hour' as date) = "DATA") ultima_extracao, current_timestamp - interval '5 hour' insert_date_atual

</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>375</xloc>
      <yloc>526</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Elimina colunas</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>EMPRESA</name>
      </field>
      <field>
        <name>PRODUTO</name>
      </field>
      <field>
        <name>DATA</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>EMPRESA</name>
        <rename>EMPRESA</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask>#</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>PRODUTO</name>
        <rename>PRODUTO</rename>
        <type>String</type>
        <length>32</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA</name>
        <rename>DATA</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1527</xloc>
      <yloc>510</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Emp x Prod</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>
            SELECT distinct cast(CODI_EMP as int) CODI_EMP, CODI_PSV, ? DATA_ESTOQUE, ? insert_date_atual FROM (
              SELECT INOTA.EMPR_INO CODI_EMP, INOTA.CODI_PSV CODI_PSV, INOTA.DEMI_NOT DMOV, INOTA.DUMANUT  FROM INOTA  WHERE INOTA.SITU_INO = '5' 
              UNION ALL 
      	      SELECT IPEDIDO.CODI_EMP, IPEDIDO.CODI_PSV, IPEDIDO.DEMI_PED, IPEDIDO.DUMANUT FROM IPEDIDO 
              UNION ALL 
      	      SELECT IPEDCOM.CODI_EMP, IPEDCOM.CODI_PSV, IPEDCOM.DATA_PEC, IPEDCOM.DUMANUT FROM IPEDCOM 
              UNION ALL       	      
      	      SELECT INFENTRA.CODI_EMP, INFENTRA.CODI_PSV, INFENTRA.DREC_NFE DMOV, INFENTRA.DUMANUT FROM INFENTRA 
      	      UNION ALL 
              SELECT REQUIS.CODI_EMP, IREQUIS.CODI_PSV, REQUIS.DATA_REQ, LEAST(IREQUIS.DUMANUT, REQUIS.DUMANUT) DUMANUT FROM IREQUIS JOIN REQUIS ON (IREQUIS.CODI_REQ = REQUIS.CODI_REQ) 
              UNION ALL 
      	      SELECT ICUPOM.CODI_EMP, ICUPOM.CODI_PSV, ICUPOM.DEMI_CUP, ICUPOM.DUMANUT FROM ICUPOM 
              UNION ALL
              SELECT DOCAVULSO.CODI_EMP, IDOCAVULSO.CODI_PSV, DOCAVULSO.DEMI_DCA, LEAST(IDOCAVULSO.DUMANUT, DOCAVULSO.DUMANUT)DUMANUT FROM IDOCAVULSO JOIN DOCAVULSO ON (IDOCAVULSO.CTRL_DCA = DOCAVULSO.CTRL_DCA) 
              UNION ALL
               SELECT ORDEMPRODUCAO.CODI_EMP, IORDEM.CODI_PSV, ACOMPANHAORDEM.DINI_ACO, LEAST(IORDEM.DUMANUT, ACOMPANHAORDEM.DUMANUT) DUMANUT  FROM IORDEM JOIN ACOMPANHAORDEM ON (ACOMPANHAORDEM.CODI_ACO = IORDEM.CODI_ACO) JOIN ORDEMPRODUCAO ON (ORDEMPRODUCAO.CODI_ORD = ACOMPANHAORDEM.CODI_ORD) 
               UNION ALL
              SELECT ICOMPROVA.CODI_EMP, ICOMPROVA.CODI_PSV, ICOMPROVA.DATA_COM DMOV, ICOMPROVA.DUMANUT FROM ICOMPROVA 
      	      UNION ALL 
      	      SELECT ROMANEIO.CODI_EMP, ROMANEIO.CODI_PSV, ROMANEIO.DEMI_ROM DMOV, ROMANEIO.DUMANUT FROM ROMANEIO 
              UNION ALL 
              SELECT CTRS.CODI_EMP, CTRS.CODI_PSV, CTRS.DATA_AJS DMOV, CTRS.DUMANUT  FROM CCIAJUSTESALDO CTRS
            ) X 
            where 
(
                ((DMOV > ? AND DMOV &lt;=?)
                OR  
				(DMOV &lt;= ? AND ?  = cast(current_timestamp - interval '33' hour as date)))
				AND (DUMANUT >=? OR ? IS NULL)
				
) --and codi_emp = 3
--and codi_psv = '0000082'

order by  CODI_EMP, CODI_PSV
                </sql>
    <limit>0</limit>
    <lookup>Select values</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>695</xloc>
      <yloc>414</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Estoque</name>
    <type>TableInput</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>

SELECT ? empresa, ? produto, ? "DATA", codi_ctr  controlesaldo,? insert_date, 'N' concluido,  sum(SALD_CTR) ESTOQUE
 FROM table(SALDO_INICIAL_TIPOEST(?, 0, ?, cast(? as date),'S',NULL, 0))

 group by codi_ctr 

--HAVING sum(SALD_CTR) &lt;&gt; 0

ORDER BY codi_ctr </sql>
    <limit>0</limit>
    <lookup>Select values 3</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1143</xloc>
      <yloc>414</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Fato Custo Produto</name>
    <type>SynchronizeAfterMerge</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <commit>10000</commit>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <use_batch>Y</use_batch>
    <perform_lookup>N</perform_lookup>
    <operation_order_field>flagfield</operation_order_field>
    <order_insert>new</order_insert>
    <order_update>changed</order_update>
    <order_delete>deleted</order_delete>
    <lookup>
      <schema>public</schema>
      <table>fatocustoproduto</table>
      <key>
        <name>DATA</name>
        <field>DATA</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>empresa</name>
        <field>empresa</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>produto</name>
        <field>produto</field>
        <condition>=</condition>
        <name2 />
      </key>
      <value>
        <name>empresa</name>
        <rename>empresa</rename>
        <update>N</update>
      </value>
      <value>
        <name>produto</name>
        <rename>produto</rename>
        <update>N</update>
      </value>
      <value>
        <name>DATA</name>
        <rename>DATA</rename>
        <update>N</update>
      </value>
      <value>
        <name>customedio</name>
        <rename>customedio</rename>
        <update>Y</update>
      </value>
      <value>
        <name>custoreposicao</name>
        <rename>custoreposicao</rename>
        <update>Y</update>
      </value>
      <value>
        <name>custocompra</name>
        <rename>custocompra</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1351</xloc>
      <yloc>1022</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Fato Mov Estoque Ctrl Saldo</name>
    <type>SynchronizeAfterMerge</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <commit>10000</commit>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <use_batch>Y</use_batch>
    <perform_lookup>N</perform_lookup>
    <operation_order_field>flagfield</operation_order_field>
    <order_insert>new</order_insert>
    <order_update>changed</order_update>
    <order_delete>deleted</order_delete>
    <lookup>
      <schema>public</schema>
      <table>fatoestoquecontrolesaldo</table>
      <key>
        <name>DATA</name>
        <field>DATA</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>empresa</name>
        <field>empresa</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>produto</name>
        <field>produto</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>controlesaldo</name>
        <field>controlesaldo</field>
        <condition>=</condition>
        <name2 />
      </key>
      <value>
        <name>empresa</name>
        <rename>empresa</rename>
        <update>N</update>
      </value>
      <value>
        <name>produto</name>
        <rename>produto</rename>
        <update>N</update>
      </value>
      <value>
        <name>controlesaldo</name>
        <rename>controlesaldo</rename>
        <update>N</update>
      </value>
      <value>
        <name>DATA</name>
        <rename>DATA</rename>
        <update>N</update>
      </value>
      <value>
        <name>estoque</name>
        <rename>estoque</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1351</xloc>
      <yloc>894</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <send_true_to>Elimina colunas</send_true_to>
    <send_false_to />
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>ESTOQUE</leftvalue>
        <function>&lt;></function>
        <rightvalue />
        <value>
          <name>constant</name>
          <type>Number</type>
          <text>0.0</text>
          <length>-1</length>
          <precision>-1</precision>
          <isnull>N</isnull>
          <mask>#</mask>
        </value>
      </condition>
    </compare>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1351</xloc>
      <yloc>510</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Flag Concluido</name>
    <type>ExecSQL</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <execute_each_row>Y</execute_each_row>
    <single_statement>N</single_statement>
    <replace_variables>N</replace_variables>
    <quoteString>N</quoteString>
    <sql>update fatoestoquesaldoinicial set concluido = 'S' where "DATA" = ?</sql>
    <set_params>Y</set_params>
    <insert_field />
    <update_field />
    <delete_field />
    <read_field />
    <arguments>
      <argument>
        <name>data_estoque</name>
      </argument>
    </arguments>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>647</xloc>
      <yloc>750</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Group by</name>
    <type>GroupBy</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <all_rows>N</all_rows>
    <ignore_aggregate>N</ignore_aggregate>
    <field_ignore />
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>grp</prefix>
    <add_linenr>N</add_linenr>
    <linenr_fieldname />
    <give_back_row>N</give_back_row>
    <group>
      <field>
        <name>DATA</name>
      </field>
      <field>
        <name>EMPRESA</name>
      </field>
      <field>
        <name>PRODUTO</name>
      </field>
    </group>
    <fields>
      </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1527</xloc>
      <yloc>606</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Merge Join</name>
    <type>MergeJoin</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <join_type>LEFT OUTER</join_type>
    <step1>Select values Estoque</step1>
    <step2>Select values custo</step2>
    <keys_1>
      <key>DATA</key>
      <key>EMPRESA</key>
      <key>PRODUTO</key>
    </keys_1>
    <keys_2>
      <key>DATA</key>
      <key>EMPRESA</key>
      <key>PRODUTO</key>
    </keys_2>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1127</xloc>
      <yloc>686</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Merge Rows (diff)</name>
    <type>MergeRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <keys>
      <key>DATA</key>
      <key>empresa</key>
      <key>produto</key>
      <key>controlesaldo</key>
    </keys>
    <values>
      <value>estoque</value>
    </values>
    <flag_field>flagfield</flag_field>
    <reference>fato</reference>
    <compare>stage estoque</compare>
    <compare>
    </compare>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1159</xloc>
      <yloc>894</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Merge Rows (diff) 2</name>
    <type>MergeRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <keys>
      <key>DATA</key>
      <key>empresa</key>
      <key>produto</key>
    </keys>
    <values>
      <value>customedio</value>
      <value>custoreposicao</value>
      <value>custocompra</value>
    </values>
    <flag_field>flagfield</flag_field>
    <reference>fato 2</reference>
    <compare>stage custo</compare>
    <compare>
    </compare>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1159</xloc>
      <yloc>1022</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Merge Rows (diff) 3</name>
    <type>MergeRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <keys>
      <key>CODI_CTR</key>
    </keys>
    <values>
      <value>CODI_CTR</value>
    </values>
    <flag_field>flagfield</flag_field>
    <reference>TIPO 0</reference>
    <compare>ORIGEM</compare>
    <compare>
    </compare>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>551</xloc>
      <yloc>286</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Merge Rows (diff) 4</name>
    <type>MergeRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <keys>
      <key>empresa</key>
      <key>produto</key>
      <key>DATA</key>
      <key>controlesaldo</key>
    </keys>
    <values>
      <value>empresa</value>
      <value>produto</value>
      <value>DATA</value>
      <value>controlesaldo</value>
    </values>
    <flag_field>flagfield</flag_field>
    <reference>Sort rows from DW</reference>
    <compare>Select values from ERP</compare>
    <compare>
    </compare>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>839</xloc>
      <yloc>686</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>ORIGEM</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>SELECT DISTINCT CODI_CTR, '0' TIPO_EST, 'A' FUNC_EST FROM ESTOQUE WHERE TIPO_EST &lt;&gt; 0 ORDER BY CODI_CTR</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>407</xloc>
      <yloc>222</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select from DW</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>
SELECT 
	EMPRESA,
	PRODUTO,
	"DATA",
	CONTROLESALDO,
	INSERT_DATE,
	ESTOQUE,
	'N' CONCLUIDO,
	CUSTOMEDIO,
	CUSTOREPOSICAO,
	CUSTOCOMPRA
FROM FATOESTOQUESALDOINICIAL WHERE "DATA" = ?
order by EMPRESA, PRODUTO, CONTROLESALDO</sql>
    <limit>0</limit>
    <lookup>Select values 5</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>695</xloc>
      <yloc>526</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>data_estoque</name>
        <rename>data_estoque1</rename>
      </field>
      <field>
        <name>insert_date_atual</name>
      </field>
      <field>
        <name>data_partida_mov</name>
        <rename>data_partida_mov1</rename>
      </field>
      <field>
        <name>data_estoque</name>
        <rename>data_estoque2</rename>
      </field>
      <field>
        <name>data_partida_mov</name>
        <rename>data_partida_mov2</rename>
      </field>
      <field>
        <name>data_estoque</name>
        <rename>data_estoque3</rename>
      </field>
      <field>
        <name>ultima_extracao</name>
        <rename>ultima_extracao1</rename>
      </field>
      <field>
        <name>ultima_extracao</name>
        <rename>ultima_extracao2</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>503</xloc>
      <yloc>414</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values 2</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>data_estoque</name>
        <rename>data_estoque1</rename>
      </field>
      <field>
        <name>data_estoque</name>
        <rename>data_estoque2</rename>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>391</xloc>
      <yloc>750</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values 3</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>CODI_EMP</name>
        <rename>CODI_EMP1</rename>
      </field>
      <field>
        <name>CODI_PSV</name>
        <rename>CODI_PSV1</rename>
      </field>
      <field>
        <name>DATA_ESTOQUE</name>
        <rename>DATA_ESTOQUE1</rename>
      </field>
      <field>
        <name>insert_date_atual</name>
      </field>
      <field>
        <name>CODI_EMP</name>
        <rename>CODI_EMP2</rename>
      </field>
      <field>
        <name>CODI_PSV</name>
        <rename>CODI_PSV2</rename>
      </field>
      <field>
        <name>DATA_ESTOQUE</name>
        <rename>DATA_ESTOQUE2</rename>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>CODI_EMP1</name>
        <rename>CODI_EMP1</rename>
        <type>Integer</type>
        <length>38</length>
        <precision>0</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CODI_PSV1</name>
        <rename>CODI_PSV1</rename>
        <type>String</type>
        <length>15</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA_ESTOQUE1</name>
        <rename>DATA_ESTOQUE1</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>insert_date_atual</name>
        <rename>insert_date_atual</rename>
        <type>Timestamp</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CODI_EMP2</name>
        <rename>CODI_EMP2</rename>
        <type>Integer</type>
        <length>38</length>
        <precision>0</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CODI_PSV2</name>
        <rename>CODI_PSV2</rename>
        <type>String</type>
        <length>15</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA_ESTOQUE2</name>
        <rename>DATA_ESTOQUE2</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>999</xloc>
      <yloc>414</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values 5</name>
    <type>SelectValues</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>data_estoque</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>503</xloc>
      <yloc>526</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values Estoque</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>EMPRESA</name>
      </field>
      <field>
        <name>PRODUTO</name>
      </field>
      <field>
        <name>DATA</name>
      </field>
      <field>
        <name>CONTROLESALDO</name>
      </field>
      <field>
        <name>insert_date</name>
      </field>
      <field>
        <name>ESTOQUE</name>
      </field>
      <field>
        <name>CONCLUIDO</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>EMPRESA</name>
        <rename>EMPRESA</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask>#</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>PRODUTO</name>
        <rename>PRODUTO</rename>
        <type>String</type>
        <length>32</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA</name>
        <rename>DATA</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CONTROLESALDO</name>
        <rename>CONTROLESALDO</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask>#</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>insert_date</name>
        <rename>insert_date</rename>
        <type>Timestamp</type>
        <length>0</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>ESTOQUE</name>
        <rename>ESTOQUE</rename>
        <type>Number</type>
        <length>30</length>
        <precision>9</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CONCLUIDO</name>
        <rename>CONCLUIDO</rename>
        <type>String</type>
        <length>1</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1143</xloc>
      <yloc>606</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values custo</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>EMPRESA</name>
      </field>
      <field>
        <name>PRODUTO</name>
      </field>
      <field>
        <name>DATA</name>
      </field>
      <field>
        <name>CUSTOMEDIO</name>
      </field>
      <field>
        <name>CUSTOREPOSICAO</name>
      </field>
      <field>
        <name>CUSTOCOMPRA</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>EMPRESA</name>
        <rename>EMPRESA</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask>#</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>PRODUTO</name>
        <rename>PRODUTO</rename>
        <type>String</type>
        <length>32</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA</name>
        <rename>DATA</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask>yyyy-MM-dd</conversion_mask>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOMEDIO</name>
        <rename>CUSTOMEDIO</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOREPOSICAO</name>
        <rename>CUSTOREPOSICAO</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOCOMPRA</name>
        <rename>CUSTOCOMPRA</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1335</xloc>
      <yloc>702</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values from ERP</name>
    <type>SelectValues</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <fields>
      <field>
        <name>EMPRESA</name>
      </field>
      <field>
        <name>PRODUTO</name>
      </field>
      <field>
        <name>DATA</name>
      </field>
      <field>
        <name>CONTROLESALDO</name>
      </field>
      <field>
        <name>insert_date</name>
      </field>
      <field>
        <name>ESTOQUE</name>
      </field>
      <field>
        <name>CONCLUIDO</name>
      </field>
      <field>
        <name>CUSTOMEDIO</name>
      </field>
      <field>
        <name>CUSTOREPOSICAO</name>
      </field>
      <field>
        <name>CUSTOCOMPRA</name>
      </field>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>EMPRESA</name>
        <rename>EMPRESA</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>PRODUTO</name>
        <rename>PRODUTO</rename>
        <type>String</type>
        <length>32</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>DATA</name>
        <rename>DATA</rename>
        <type>Date</type>
        <length>9</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CONTROLESALDO</name>
        <rename>CONTROLESALDO</rename>
        <type>Integer</type>
        <length>9</length>
        <precision>0</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>insert_date</name>
        <rename>insert_date</rename>
        <type>Timestamp</type>
        <length>0</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>ESTOQUE</name>
        <rename>ESTOQUE</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>9</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CONCLUIDO</name>
        <rename>CONCLUIDO</rename>
        <type>String</type>
        <length>1</length>
        <precision>-2</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOMEDIO</name>
        <rename>CUSTOMEDIO</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOREPOSICAO</name>
        <rename>CUSTOREPOSICAO</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
      <meta>
        <name>CUSTOCOMPRA</name>
        <rename>CUSTOCOMPRA</rename>
        <type>BigNumber</type>
        <length>30</length>
        <precision>4</precision>
        <conversion_mask />
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale />
        <date_format_timezone />
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding />
        <decimal_symbol />
        <grouping_symbol />
        <currency_symbol />
        <storage_type />
      </meta>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>983</xloc>
      <yloc>686</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort rows</name>
    <type>SortRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>100000</sort_size>
    <free_memory />
    <compress>N</compress>
    <compress_variable />
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>DATA_ESTOQUE</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>Y</presorted>
      </field>
      <field>
        <name>CODI_EMP</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>Y</presorted>
      </field>
      <field>
        <name>CODI_PSV</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>839</xloc>
      <yloc>414</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort rows from DW</name>
    <type>SortRows</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory />
    <compress>N</compress>
    <compress_variable />
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>DATA</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>Y</presorted>
      </field>
      <field>
        <name>empresa</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>Y</presorted>
      </field>
      <field>
        <name>produto</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
      <field>
        <name>controlesaldo</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>839</xloc>
      <yloc>526</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sync saldo inicial</name>
    <type>SynchronizeAfterMerge</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <commit>100</commit>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <use_batch>Y</use_batch>
    <perform_lookup>N</perform_lookup>
    <operation_order_field>flagfield</operation_order_field>
    <order_insert>new</order_insert>
    <order_update>changed</order_update>
    <order_delete>deleted</order_delete>
    <lookup>
      <schema>public</schema>
      <table>fatoestoquesaldoinicial</table>
      <key>
        <name>empresa</name>
        <field>empresa</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>produto</name>
        <field>produto</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>DATA</name>
        <field>DATA</field>
        <condition>=</condition>
        <name2 />
      </key>
      <key>
        <name>controlesaldo</name>
        <field>controlesaldo</field>
        <condition>=</condition>
        <name2 />
      </key>
      <value>
        <name>empresa</name>
        <rename>empresa</rename>
        <update>N</update>
      </value>
      <value>
        <name>produto</name>
        <rename>produto</rename>
        <update>N</update>
      </value>
      <value>
        <name>DATA</name>
        <rename>DATA</rename>
        <update>N</update>
      </value>
      <value>
        <name>controlesaldo</name>
        <rename>controlesaldo</rename>
        <update>N</update>
      </value>
      <value>
        <name>insert_date</name>
        <rename>insert_date</rename>
        <update>Y</update>
      </value>
      <value>
        <name>estoque</name>
        <rename>estoque</rename>
        <update>Y</update>
      </value>
      <value>
        <name>concluido</name>
        <rename>concluido</rename>
        <update>Y</update>
      </value>
      <value>
        <name>customedio</name>
        <rename>customedio</rename>
        <update>Y</update>
      </value>
      <value>
        <name>custoreposicao</name>
        <rename>custoreposicao</rename>
        <update>Y</update>
      </value>
      <value>
        <name>custocompra</name>
        <rename>custocompra</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>839</xloc>
      <yloc>782</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Synchronize after merge</name>
    <type>SynchronizeAfterMerge</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <commit>100</commit>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <use_batch>Y</use_batch>
    <perform_lookup>N</perform_lookup>
    <operation_order_field>flagfield</operation_order_field>
    <order_insert>new</order_insert>
    <order_update>changed</order_update>
    <order_delete>deleted</order_delete>
    <lookup>
      <schema />
      <table>ESTOQUE</table>
      <key>
        <name>CODI_CTR</name>
        <field>CODI_CTR</field>
        <condition>=</condition>
        <name2 />
      </key>
      <value>
        <name>CODI_CTR</name>
        <rename>CODI_CTR</rename>
        <update>N</update>
      </value>
      <value>
        <name>TIPO_EST</name>
        <rename>TIPO_EST</rename>
        <update>Y</update>
      </value>
      <value>
        <name>FUNC_EST</name>
        <rename>FUNC_EST</rename>
        <update>Y</update>
      </value>
    </lookup>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>711</xloc>
      <yloc>286</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>TIPO 0</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>SELECT CODI_CTR, TIPO_EST, FUNC_EST FROM ESTOQUE WHERE TIPO_EST = 0 ORDER BY CODI_CTR</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>407</xloc>
      <yloc>334</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Wait Flag</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>N</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Flag Concluido</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>471</xloc>
      <yloc>942</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>datas estoque afetadas</name>
    <type>Unique</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <count_rows>N</count_rows>
    <count_field />
    <reject_duplicate_row>N</reject_duplicate_row>
    <error_description />
    <fields>
      <field>
        <name>data_estoque</name>
        <case_insensitive>N</case_insensitive>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>503</xloc>
      <yloc>638</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>fato</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>select empresa,
	produto,
	controlesaldo,
	cast(? as date) "DATA",
	estoque
from fatoestoquecontrolesaldo
where "DATA" = ?
	order by 
	empresa, 
	produto,
	controlesaldo</sql>
    <limit>0</limit>
    <lookup>Wait Flag</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>903</xloc>
      <yloc>814</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>fato 2</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>select empresa,
	produto,
	cast(? as date) "DATA",
	customedio,
	custoreposicao,
	custocompra
from fatocustoproduto
where "DATA" = ?
order by
	empresa, 
	produto</sql>
    <limit>0</limit>
    <lookup>Wait Flag</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>903</xloc>
      <yloc>1070</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>stage custo</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>
with fechamento_por_produto as 
(select empresa , produto , max("DATA") as "DATA"
from fatoestoquesaldoinicial 
where "DATA" &lt;= ?
group by  empresa , produto 
order by  empresa , produto )

select distinct f.empresa , f.produto ,  cast(? as date) "DATA" ,  sf.customedio, sf.custoreposicao, sf.custocompra
from fechamento_por_produto f 
inner join  fatoestoquesaldoinicial sf
	on f.empresa = sf.empresa 
	and f.produto = sf.produto 
	and f."DATA" = sf."DATA"
	
where sf.estoque &lt;&gt; 0
order by 
f.empresa , f.produto 

	



</sql>
    <limit>0</limit>
    <lookup>Wait Flag</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>903</xloc>
      <yloc>974</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>stage estoque</name>
    <type>TableInput</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <sql>
with fechamento_por_produto as 
(select empresa , produto ,  max("DATA") as "DATA"
from fatoestoquesaldoinicial 
where "DATA" &lt;= ?
group by  empresa , produto 
order by  empresa , produto )

select f.empresa , f.produto , sf.controlesaldo , cast(? as date) "DATA" , sf.estoque
from fechamento_por_produto f 
inner join  fatoestoquesaldoinicial sf
	on f.empresa = sf.empresa 
	and f.produto = sf.produto 
	and f."DATA" = sf."DATA"
where sf.estoque &lt;&gt; 0
order by 
f.empresa , f.produto , sf.controlesaldo

	



</sql>
    <limit>0</limit>
    <lookup>Wait Flag</lookup>
    <execute_each_row>Y</execute_each_row>
    <variables_active>N</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>903</xloc>
      <yloc>894</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>wait insert/update</name>
    <type>BlockUntilStepsFinish</type>
    <description />
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <steps>
      <step>
        <name>Sync saldo inicial</name>
        <CopyNr>0</CopyNr>
      </step>
    </steps>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>503</xloc>
      <yloc>750</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
