<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>fatoComissaoRecebimento</name>
    <description />
    <extended_description />
    <trans_version />
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
    </parameters>
        <log>
      <trans-log-table>
        <connection>SQL Server</connection>
        <schema />
        <table>dimArquivoTransformacao</table>
        <size_limit_lines />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject />
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject />
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject />
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject />
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject />
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection />
        <schema />
        <table />
        <interval />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection />
        <schema />
        <table />
        <timeout_days />
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection />
      <table />
      <field />
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file />
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2015/09/02 16:35:08.215</created_date>
    <modified_user>-</modified_user>
    <modified_date>2015/09/02 16:35:08.215</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>Oracle</name>
    <server>10.0.0.18</server>
    <type>ORACLE</type>
    <access>Native</access>
    <database>ORCL</database>
    <port>1521</port>
    <username>SINAGRO</username>
    <password>Encrypted 2be98afc86aa7f289aa0aba75cc99aac3</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1521</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <connection>
    <name>SQL Server</name>
    <server>10.0.0.245</server>
    <type>MSSQL</type>
    <access>Native</access>
    <database>DWAI</database>
    <port>1433</port>
    <username>itprovider</username>
    <password>Encrypted 2be98afc86aa78285b80aa764ce8ab6c0</password>
    <servername />
    <data_tablespace />
    <index_tablespace />
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1433</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>GET</from>
      <to>Export to DW 2</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>Export to DW 2</name>
    <type>TableOutput</type>
    <description>Write information to table [TABDESC] on database [SQL Server]</description>
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>SQL Server</connection>
    <schema />
    <table>fatoComissaoRecebimento</table>
    <commit>1000</commit>
    <truncate>Y</truncate>
    <ignore_errors>N</ignore_errors>
    <use_batch>Y</use_batch>
    <specify_fields>Y</specify_fields>
    <partitioning_enabled>N</partitioning_enabled>
    <partitioning_field>DUMANUT</partitioning_field>
    <partitioning_daily>Y</partitioning_daily>
    <partitioning_monthly>N</partitioning_monthly>
    <tablename_in_field>N</tablename_in_field>
    <tablename_field />
    <tablename_in_table>N</tablename_in_table>
    <return_keys>N</return_keys>
    <return_field />
    <fields>
      <field>
        <column_name>EMPRESA</column_name>
        <stream_name>EMPRESA</stream_name>
      </field>
      <field>
        <column_name>VENDEDOR</column_name>
        <stream_name>VENDEDOR</stream_name>
      </field>
      <field>
        <column_name>PRODUTO</column_name>
        <stream_name>PRODUTO</stream_name>
      </field>
      <field>
        <column_name>CLIENTE</column_name>
        <stream_name>CLIENTE</stream_name>
      </field>
      <field>
        <column_name>CODIGODOCUMENTO</column_name>
        <stream_name>CODIGODOCUMENTO</stream_name>
      </field>
      <field>
        <column_name>CODIGOBAIXA</column_name>
        <stream_name>CODIGOBAIXA</stream_name>
      </field>
      <field>
        <column_name>VALORFATURADO</column_name>
        <stream_name>VALORFATURADO</stream_name>
      </field>
      <field>
        <column_name>VALORRECEBIDO</column_name>
        <stream_name>VALORRECEBIDO</stream_name>
      </field>
      <field>
        <column_name>VENCIMENTO</column_name>
        <stream_name>VENCIMENTO</stream_name>
      </field>
      <field>
        <column_name>DATABAIXA</column_name>
        <stream_name>DATABAIXA</stream_name>
      </field>
      <field>
        <column_name>VALORCOMISSAO</column_name>
        <stream_name>VALORCOMISSAO</stream_name>
      </field>
      <field>
        <column_name>TIPOVENDEDOR</column_name>
        <stream_name>TIPOVENDEDOR</stream_name>
      </field>
      <field>
        <column_name>DATAFATURAMENTO</column_name>
        <stream_name>DATAFATURAMENTO</stream_name>
      </field>
      <field>
        <column_name>CONDICAOPAGAMENTO</column_name>
        <stream_name>CONDICAOPAGAMENTO</stream_name>
      </field>
      <field>
        <column_name>VALORPAGOCOMIS</column_name>
        <stream_name>VALORPAGOCOMIS</stream_name>
      </field>
    </fields>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>350</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>GET</name>
    <type>TableInput</type>
    <description>Reads information from table [TABDESC] on database [Oracle]</description>
    <distribute>Y</distribute>
    <custom_distribution />
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name />
    </partitioning>
    <connection>Oracle</connection>
    <sql>      select
       C.CODI_EMP EMPRESA,
       PI.CODI_PES VENDEDOR,
       I.CODI_PSV PRODUTO,
       C.CODI_TRA CLIENTE,
       R.COND_CON CONDICAOPAGAMENTO,
       C.CTRL_CBR CODIGODOCUMENTO,
        B.SEQU_BAI CODIGOBAIXA,
       B.VLOR_BAI - 
       (B.VLOR_BAI - (B.VLOR_BAI / (select VALOR_IND from TABLE(RET_VLORIND(B.CODI_EMP, B.CODI_IND, B.DATA_VLR))) * (select VALOR_IND from TABLE(RET_VLORIND(R.EMPR_VLR, R.CODI_IND, R.DATA_VLR))/*etable*/))) as VALORFATURADO,
       CASE WHEN TP.TIPO_TPG = 1 THEN
            ((coalesce(B.VLOR_BAI, 0) - coalesce(B.DESC_BAI, 0) + coalesce(B.JURO_BAI, 0) 
                             + coalesce(B.MULT_BAI, 0) + coalesce(B.ACRE_BAI, 0)) * (SUM(CR.VLOR_CHR) / L.VLOR_LAN)  ) 
         ELSE
         coalesce(B.VLOR_BAI, 0) - coalesce(B.DESC_BAI, 0) + coalesce(B.JURO_BAI, 0) + coalesce(B.MULT_BAI, 0) + coalesce(B.ACRE_BAI, 0)
         END
       VALORRECEBIDO,
       R.VENC_REC VENCIMENTO,
       B.DPAG_BAI DATABAIXA,
(PI.COMI_PIN/100)*((CP.QTDP_BPR/(select sum(I1.QTDE_INO) from INOTA I1 where I1.NPRE_NOT = N.NPRE_NOT and I1.CODI_PSV = CP.CODI_PSV))*i.qtde_ino) * I.VLIQ_INO *((CASE WHEN TP.TIPO_TPG = 1 THEN
            ((coalesce(B.VLOR_BAI, 0) - coalesce(B.DESC_BAI, 0) ) * (SUM(CR.VLOR_CHR) / L.VLOR_LAN)  )
         ELSE
         coalesce(B.VLOR_BAI, 0) - coalesce(B.DESC_BAI, 0)
         END)
         /(B.VLOR_BAI - (B.VLOR_BAI - (B.VLOR_BAI /
         (select VALOR_IND from /*btable*/ TABLE(RET_VLORIND(B.CODI_EMP, B.CODI_IND, B.DATA_VLR))/*etable*/) *
          (select VALOR_IND from /*btable*/ TABLE(RET_VLORIND(R.EMPR_VLR, R.CODI_IND, R.DATA_VLR))/*etable*/))))) VALORCOMISSAO,
    case when PI.CODI_PES = N.COD1_PES then
    'VENDEDOR 1'
    when PI.CODI_PES = N.COD2_PES then
    'VENDEDOR 2'
    else 'SUPERVISOR'
    end TIPOVENDEDOR, C.DATA_CBR DATAFATURAMENTO,
    (SELECT SUM(CIN.VLOR_CCI) FROM COMICRCINOTA CIN WHERE CIN.SEQU_BAI=B.SEQU_BAI AND CIN.NPRE_NOT=I.NPRE_NOT AND CIN.ITEM_INO=I.ITEM_INO AND CIN.CODI_PES=V.CODI_PES) VALORPAGOCOMIS
      from CRCBAIXA B
      inner join LANCAMEN L on (L.CTRL_LAN = B.CTRL_LAN) 
      inner join TIPOPAG TP on B.CODI_TPG = TP.CODI_TPG 
      inner join RECEBER R on R.CTRL_REC = B.CTRL_REC 
      inner join CABREC C on C.CTRL_CBR = R.CTRL_CBR 
      inner join TRANSAC T on (C.CODI_TRA = T.CODI_TRA)
      inner join TIPDOC TD on (C.CODI_TDO = TD.CODI_TDO) 
      inner join CRCBAIPR CP on (CP.sequ_bai = b.sequ_bai) 
      inner join NOTACRC NC on (NC.CTRL_CBR = C.CTRL_CBR) 
      inner join NOTA N on (N.CODI_EMP = NC.CODI_EMP and N.NOTA_NOT =  NC.NDOC_NOC and N.SERI_NOT = NC.SDOC_NOC) 
      inner join INOTA I on (I.NPRE_NOT = N.NPRE_NOT and I.CODI_PSV = CP.CODI_PSV ) 
      left join CABTAB CT on (CT.TABE_CTA = I.TABE_CTA)
      left join PEDIDO PD on (I.EMPR_PED = PD.CODI_EMP and I.PEDI_PED = PD.PEDI_PED and I.SERI_PED = PD.SERI_PED)
      /*left*/ join PINOTA PI on (PI.NPRE_NOT = I.NPRE_NOT and PI.ITEM_INO = I.ITEM_INO)
      /*left*/ join PESSOAL P on (P.CODI_PES = PI.CODI_PES)
      /*left*/ join VENDEDOR V on (P.CODI_PES = V.CODI_PES)
      inner join PRODSERV PR on (PR.CODI_PSV = I.CODI_PSV) 
      LEFT OUTER JOIN CHQRECLANC CL ON (CL.CTRL_LAN = B.CTRL_LAN)
      LEFT OUTER JOIN CHEQUEREC CR ON (CR.NUME_CHR = CL.NUME_CHR AND CR.SERI_CHR = CL.SERI_CHR AND CR.CODI_AGE = CL.CODI_AGE AND CR.CONT_CHR = CL.CONT_CHR AND CR.CODI_EMP = CL.CODI_EMP)
      where 

      B.SITU_BAI = 'N' AND
      TP.COMI_TPG = 'S' AND
      TD.TIPO_TDO = 'D' AND
      C.TDRL_CBR = 'NE'

       GROUP BY 
       C.CODI_EMP,  B.SEQU_BAI,  B.VLOR_BAI,  B.CODI_EMP, B.CODI_IND,  B.DATA_VLR,  R.EMPR_VLR,
       R.CODI_IND,  R.DATA_VLR,  B.DESC_BAI, TP.TIPO_TPG, B.DESC_BAI,  B.JURO_BAI, 
       B.MULT_BAI,  B.ACRE_BAI,  L.VLOR_LAN , R.DPON_REC, TP.DTCO_TPG, B.DTPC_BAI,  B.DPAG_BAI, 
       B.CTRL_REC,  R.VENC_REC,  R.NPAR_REC,  C.NUME_CBR, C.SERI_CBR,  C.DATA_CBR,  C.CTRL_CBR, 
       C.CODI_TRA,  C.TDRL_CBR,  C.CODI_TDO,  T.RAZA_TRA, TD.DESC_TDO, P.NOME_PES,  PI.CODI_PES, 
       N.COD1_PES, N.COD2_PES, 
       N.NOTA_NOT,  N.SERI_NOT,  N.TOTA_NOT,  N.TPRO_NOT, N.ACRE_NOT,  N.DESC_NOT,  N.NPRE_NOT, 
       PI.COMI_PIN, PI.VLCM_PIN, PI.PEBR_PIN, PI.ORIG_PIN, I.CODI_PSV, I.PEDI_PED, I.SERI_PED,  CP.QTDP_BPR, I.PVTB_INO, I.CTAB_INO,  I.VLOR_INO,  I.DSAC_INO, 
       I.ITEM_INO,  N.CODI_TOP, PR.DESC_PSV, PR.CODI_GPR, PR.CODI_SBG, I.NPRE_NOT,  I.ITEM_INO, N.NPRE_NOT,  CP.CODI_PSV, I.QTDE_INO 
       ,CT.TCOM_CTA ,I.DSOF_INO, I.VDOF_INO,R.COND_CON,I.NPRE_NOT,I.ITEM_INO,V.CODI_PES,B.SEQU_BAI, I.VLIQ_INO

union all 

  select
       N.CODI_EMP EMPRESA,
       PI.CODI_PES VENDEDOR,
       I.CODI_PSV PRODUTO,
       N.CODI_TRA CLIENTE,
        N.COND_CON CONDICAOPAGAMENTO,
       -1 CODIGODOCUMENTO,

       lan.ctrl_lan CODIGOBAIXA,
       0 VALORFATURADO,
       0 VALORRECEBIDO,

        N.DEMI_NOT VENCIMENTO,
        N.DEMI_NOT DATABAIXA,

        (SUM(EN.VLOR_ENO)/n.TOTA_NOT)*I.VLIQ_INO*I.QTDE_INO*(PI.COMI_PIN/100) VALORCOMISSAO,

        case when PI.CODI_PES = N.COD1_PES then                      
          'VENDEDOR 1'                                               
          when PI.CODI_PES = N.COD2_PES then                           
          'VENDEDOR 2'                                               
          else 'SUPERVISOR'
          end TIPOVENDEDOR,



          N.DEMI_NOT DATAFATURAMENTO,

          --0 BASECALCULO,



          COALESCE((
        SELECT SUM(B.VLO1_BCN)                                                                      
        FROM BAICOMINOTA B                                                                          
        WHERE (PI.NPRE_NOT = B.NPRE_NOT and PI.ITEM_INO = B.ITEM_INO and PI.CODI_PES = B.CODI_PES)  
       ), 0)  VALORPAGOCOMIS



                         /*

                     n.TOTA_NOT,

        N.NOTA_NOT, N.SERI_NOT, 
        EN.DTPC_ENO, N.NPRE_NOT,
        T.RAZA_TRA,
       P.NOME_PES,

        PI.COMI_PIN, PI.VLCM_PIN, PI.PEBR_PIN, PI.ORIG_PIN,

         I.QTDE_INO, I.PVTB_INO, I.CTAB_INO, I.VLOR_INO,
       sum(round(( coalesce((I.PVTB_INO - (I.VLOR_INO + I.DSAC_INO) ),0) * 100)/ case when (coalesce(I.PVTB_INO, 1) = 0) then 1 else coalesce(I.PVTB_INO,1)end,2)) AS DESC_CALC, 

       I.DSAC_INO, I.ITEM_INO, N.ACRE_NOT, N.DESC_NOT, N.TPRO_NOT, N.TOTA_NOT, PR.DESC_PSV, PR.CODI_GPR, PR.CODI_SBG,
       N.FRET_NOT, N.SEGU_NOT, N.OUTR_NOT, 
       FT.FUNC_TOP,


       I.PEDI_PED, I.SERI_PED                                                                       
       ,CT.TCOM_CTA, I.DSOF_INO, I.VDOF_INO     */


      from NOTA N 
      inner join FUNCAOTOPER FT on (FT.CODI_TOP = N.CODI_TOP and FT.CODI_PTO = 199 )
      inner join TRANSAC T on (N.CODI_TRA = T.CODI_TRA) 
      inner join INOTA I on (I.NPRE_NOT = N.NPRE_NOT) 
      left  join CABTAB CT on (CT.TABE_CTA = I.TABE_CTA) 
      inner join PINOTA PI on (PI.NPRE_NOT = I.NPRE_NOT and PI.ITEM_INO = I.ITEM_INO) 
      inner join PESSOAL P on (P.CODI_PES = PI.CODI_PES) 
      left  join VENDEDOR V on (P.CODI_PES = V.CODI_PES) 
      inner join PRODSERV PR on (PR.CODI_PSV = I.CODI_PSV) 
      inner join ENTRNOTA EN ON (EN.NOTA_NOT = N.NOTA_NOT AND EN.CODI_EMP = N.CODI_EMP AND EN.SERI_NOT = N.SERI_NOT)
      inner join LANCAMEN LAN ON (EN.ctrl_lan = lan.ctrl_lan)
      inner JOIN TIPOPAG TP on (TP.CODI_TPG = EN.CODI_TPG)
      where (EN.VLOR_ENO > 0) and (
             ((TP.TIPO_TPG = '1')
         and (exists (select CL.NUME_CHR
                      FROM CHQRECLANC CL
                      LEFT OUTER JOIN CHEQUEREC CR ON (CR.NUME_CHR = CL.NUME_CHR)
                                                  AND (CR.SERI_CHR = CL.SERI_CHR)
                                                  AND (CR.CODI_AGE = CL.CODI_AGE)
                                                  AND (CR.CONT_CHR = CL.CONT_CHR)
                                                  AND (CR.CODI_EMP = CL.CODI_EMP)
                      where (CL.CTRL_LAN = EN.CTRL_LAN)
                         )))
         or  ((TP.TIPO_TPG &lt;&gt; '1') and

      -- SE A DATA DO PAGAMENTO DE COMISSAO FOR NULA UTILIZA A DATA DE EMISSAO DA NOTA FISCAL
          (((EN.DTPC_ENO is null)
      )
      -- SE A DATA DO PAGAMENTO DE COMISSAO NAO FOR NULA UTILIZA ESTA DATA
      or  ((EN.DTPC_ENO is not null)
      )))     )

      -- DATA DE EMISSAO DA NOTA FISCAL


      and (N.SITU_NOT = '5')
      and (LAN.SITU_LAN &lt;&gt; 'T')
--      and pi.CODI_PES = 11000242
          ---and pi.CODI_PES = 11000108   and n.nota_not = 42293
      GROUP BY
      N.CODI_EMP, N.NOTA_NOT, N.SERI_NOT, N.DEMI_NOT, EN.DTPC_ENO,
      N.NPRE_NOT, N.CODI_TRA, T.RAZA_TRA, P.NOME_PES,
      N.COD1_PES, N.COD2_PES,
      PI.CODI_PES, PI.COMI_PIN, PI.VLCM_PIN, PI.PEBR_PIN, PI.ORIG_PIN, I.CODI_PSV, I.QTDE_INO, I.PVTB_INO,
      I.CTAB_INO, I.VLOR_INO, I.DSAC_INO, I.ITEM_INO, N.ACRE_NOT,
      N.DESC_NOT, N.TPRO_NOT, N.TOTA_NOT, PR.DESC_PSV, PR.CODI_GPR, PR.CODI_SBG, N.FRET_NOT,
      N.SEGU_NOT, N.OUTR_NOT, FT.FUNC_TOP, I.EMPR_PED, I.PEDI_PED, I.SERI_PED,
      I.SERI_PED,PI.NPRE_NOT, PI.ITEM_INO, PI.CODI_PES,
      CT.TCOM_CTA, I.DSOF_INO, I.VDOF_INO, N.COND_CON, lan.ctrl_lan, I.VLIQ_INO


</sql>
    <limit>0</limit>
    <lookup />
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <cluster_schema />
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>176</xloc>
      <yloc>99</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
</transformation>
